<js>
    let activeData = this.props.tree.data[this.props.tree.active];

    return
    <div className="builder-tree">
        <builder:Index.Popups ref="js: ref => this.popups = ref" />

        <ui:Popup name="tree-cm" position="mouse" ref="js: ref => this.treeCM = ref">
            <div className="tree-context-menu">
                <For each="data.contextMenu" as="menuItem">
                    <If condition="this.contextMenuVisible(data.treeItem, menuItem)">
                        <If condition="typeof menuItem == 'string'">
                            <div className="tree-context-menu-itemsep"></div>
                        </If>
                        <Else>
                            <div className="tree-context-menu-item"
                                 js:spread="this.contextMenuProps.bind(this)(data.treeItem, menuItem, hide)">
                                <js>menuItem.label</js>
                            </div>
                        </Else>
                    </If>
                </For>
            </div>
        </ui:Popup>

        <ui:Tree data="activeData" childKey="childs">
            <div className="tree-box">
                <ui:Tree.Item>
                    <div className="tree-item"
                         data-popup-rclick:tree-cm="js: {
                            contextMenu: this.contextMenu,
                            treeItem: item,
                            popups: this.popups
                         }"
                         onClick="js: (e) => { this.toggleExpand(e, item) }">

                        <div className="js: 'tree-item-label' + (item.cut ? ' gray' : '')">
                            <div className="tree-item-span" style="js: { width: (item._depth * 15) + 'px'}"></div>

                            <div className="tree-item-icon">
                                <If condition="item.hasChild">
                                    <img src="js: this.getArrow(item)"/>
                                </If>
                            </div>
                            <js>item.label</js>
                        </div>

                        <If condition="js: item.childs && item.expanded">
                            <div>
                                <ui:Tree.Child/>
                            </div>
                        </If>
                    </div>
                </ui:Tree.Item>
            </div>
        </ui:Tree>

        <yard:Api ref="js: el => { this.initTree(el) }"/>
    </div>
</js>